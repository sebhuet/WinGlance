<UserControl x:Class="WinGlance.Views.SettingsTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:WinGlance.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="500" d:DesignWidth="500">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility" />
        <converters:LayoutRadioConverter x:Key="LayoutRadioConverter" />

        <Style TargetType="TextBlock" x:Key="Label">
            <Setter Property="Foreground" Value="#FFCCCCCC" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
        <Style TargetType="TextBlock" x:Key="SectionHeader">
            <Setter Property="Foreground" Value="#FFDDDDDD" />
            <Setter Property="FontSize" Value="13" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Margin" Value="0,12,0,6" />
        </Style>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Disabled"
                  Padding="8">
        <StackPanel Margin="8">

            <!-- ── Layout ─────────────────────────────────── -->
            <TextBlock Text="Layout" Style="{StaticResource SectionHeader}" />
            <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                <RadioButton Content="Horizontal" GroupName="Layout"
                             Foreground="#FFCCCCCC" Margin="0,0,16,0"
                             IsChecked="{Binding Layout, Converter={StaticResource LayoutRadioConverter}, ConverterParameter=horizontal}" />
                <RadioButton Content="Vertical" GroupName="Layout"
                             Foreground="#FFCCCCCC" Margin="0,0,16,0"
                             IsChecked="{Binding Layout, Converter={StaticResource LayoutRadioConverter}, ConverterParameter=vertical}" />
                <RadioButton Content="Grid" GroupName="Layout"
                             Foreground="#FFCCCCCC"
                             IsChecked="{Binding Layout, Converter={StaticResource LayoutRadioConverter}, ConverterParameter=grid}" />
            </StackPanel>

            <!-- ── Thumbnail Size ─────────────────────────── -->
            <TextBlock Text="Thumbnail Size" Style="{StaticResource SectionHeader}" />
            <Grid Margin="0,0,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="60" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="40" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Grid.Column="0" Text="Width" Style="{StaticResource Label}" />
                <Slider Grid.Row="0" Grid.Column="1"
                        Minimum="100" Maximum="500"
                        Value="{Binding ThumbnailWidth}"
                        TickFrequency="10" IsSnapToTickEnabled="True"
                        Margin="8,0" />
                <TextBlock Grid.Row="0" Grid.Column="2" Text="{Binding ThumbnailWidth}"
                           Style="{StaticResource Label}" HorizontalAlignment="Right" />

                <TextBlock Grid.Row="1" Grid.Column="0" Text="Height" Style="{StaticResource Label}" Margin="0,6,0,0" />
                <Slider Grid.Row="1" Grid.Column="1"
                        Minimum="75" Maximum="400"
                        Value="{Binding ThumbnailHeight}"
                        TickFrequency="10" IsSnapToTickEnabled="True"
                        Margin="8,6,8,0" />
                <TextBlock Grid.Row="1" Grid.Column="2" Text="{Binding ThumbnailHeight}"
                           Style="{StaticResource Label}" HorizontalAlignment="Right" Margin="0,6,0,0" />
            </Grid>

            <!-- ── Panel Opacity ──────────────────────────── -->
            <TextBlock Text="Panel Opacity" Style="{StaticResource SectionHeader}" />
            <Grid Margin="0,0,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="50" />
                </Grid.ColumnDefinitions>
                <Slider Grid.Column="0"
                        Minimum="0.3" Maximum="1.0"
                        Value="{Binding PanelOpacity}"
                        TickFrequency="0.05" IsSnapToTickEnabled="True" />
                <TextBlock Grid.Column="1"
                           Text="{Binding PanelOpacity, StringFormat='{}{0:P0}'}"
                           Style="{StaticResource Label}" HorizontalAlignment="Right" />
            </Grid>

            <!-- ── Polling Interval ───────────────────────── -->
            <TextBlock Text="Polling Interval" Style="{StaticResource SectionHeader}" />
            <Grid Margin="0,0,0,4">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="55" />
                </Grid.ColumnDefinitions>
                <Slider Grid.Column="0"
                        Minimum="500" Maximum="5000"
                        Value="{Binding PollingIntervalMs}"
                        TickFrequency="100" IsSnapToTickEnabled="True" />
                <TextBlock Grid.Column="1"
                           Text="{Binding PollingIntervalMs, StringFormat='{}{0} ms'}"
                           Style="{StaticResource Label}" HorizontalAlignment="Right" />
            </Grid>

            <!-- ── General ────────────────────────────────── -->
            <TextBlock Text="General" Style="{StaticResource SectionHeader}" />
            <CheckBox Content="Remember window position"
                      IsChecked="{Binding RememberPosition}"
                      Foreground="#FFCCCCCC" Margin="0,2" />
            <CheckBox Content="Close to system tray"
                      IsChecked="{Binding CloseToTray}"
                      Foreground="#FFCCCCCC" Margin="0,2" />
            <CheckBox Content="Start with Windows"
                      IsChecked="{Binding AutoStart}"
                      Foreground="#FFCCCCCC" Margin="0,2" />

            <!-- ── Hotkey ─────────────────────────────────── -->
            <TextBlock Text="Global Hotkey" Style="{StaticResource SectionHeader}" />
            <TextBox Text="{Binding Hotkey, UpdateSourceTrigger=PropertyChanged}"
                     Background="#FF2A2A2A" Foreground="#FFCCCCCC"
                     BorderBrush="#FF555555" Padding="4,3"
                     Width="180" HorizontalAlignment="Left" />

            <!-- ── LLM Analysis ───────────────────────────── -->
            <TextBlock Text="LLM Analysis" Style="{StaticResource SectionHeader}" />
            <CheckBox Content="Enable LLM analysis"
                      IsChecked="{Binding LlmEnabled}"
                      Foreground="#FFCCCCCC" Margin="0,2,0,6" />

            <StackPanel Visibility="{Binding LlmEnabled, Converter={StaticResource BoolToVisibility}}"
                        Margin="16,0,0,0">
                <Grid Margin="0,0,0,4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="80" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Provider" Style="{StaticResource Label}" Margin="0,3" />
                    <ComboBox Grid.Row="0" Grid.Column="1"
                              SelectedValue="{Binding LlmProvider}"
                              SelectedValuePath="Content"
                              Background="#FF2A2A2A" Foreground="#FFCCCCCC"
                              Margin="0,2">
                        <ComboBoxItem Content="openai" />
                        <ComboBoxItem Content="google" />
                        <ComboBoxItem Content="ollama" />
                    </ComboBox>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Endpoint" Style="{StaticResource Label}" Margin="0,3" />
                    <TextBox Grid.Row="1" Grid.Column="1"
                             Text="{Binding LlmEndpoint, UpdateSourceTrigger=PropertyChanged}"
                             Background="#FF2A2A2A" Foreground="#FFCCCCCC"
                             BorderBrush="#FF555555" Padding="4,3" Margin="0,2" />

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="API Key" Style="{StaticResource Label}" Margin="0,3" />
                    <TextBox Grid.Row="2" Grid.Column="1"
                             Text="{Binding LlmApiKey, UpdateSourceTrigger=PropertyChanged}"
                             Background="#FF2A2A2A" Foreground="#FFCCCCCC"
                             BorderBrush="#FF555555" Padding="4,3" Margin="0,2" />

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Model" Style="{StaticResource Label}" Margin="0,3" />
                    <TextBox Grid.Row="3" Grid.Column="1"
                             Text="{Binding LlmModel, UpdateSourceTrigger=PropertyChanged}"
                             Background="#FF2A2A2A" Foreground="#FFCCCCCC"
                             BorderBrush="#FF555555" Padding="4,3" Margin="0,2" />

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Stale (s)" Style="{StaticResource Label}" Margin="0,3" />
                    <StackPanel Grid.Row="4" Grid.Column="1" Orientation="Horizontal" Margin="0,2">
                        <Slider Minimum="10" Maximum="120"
                                Value="{Binding LlmStaleThresholdSeconds}"
                                TickFrequency="5" IsSnapToTickEnabled="True"
                                Width="200" />
                        <TextBlock Text="{Binding LlmStaleThresholdSeconds, StringFormat='{}{0}s'}"
                                   Style="{StaticResource Label}" Margin="8,0,0,0" />
                    </StackPanel>
                </Grid>

                <Button Content="Edit Prompt &amp; Debug Log"
                        Command="{Binding EditPromptCommand}"
                        Padding="10,3" Margin="0,4,0,0"
                        HorizontalAlignment="Left"
                        Background="#FF3A3A3A" Foreground="#FFCCCCCC"
                        BorderBrush="#FF555555" BorderThickness="1"
                        Cursor="Hand" />
            </StackPanel>

            <!-- ── Save Button ────────────────────────────── -->
            <Button Content="Save Configuration"
                    Command="{Binding SaveCommand}"
                    HorizontalAlignment="Right"
                    Margin="0,16,0,4"
                    Padding="14,5"
                    FontSize="12"
                    Background="#FF3A3A3A"
                    Foreground="#FFCCCCCC"
                    BorderBrush="#FF555555"
                    BorderThickness="1"
                    Cursor="Hand" />

        </StackPanel>
    </ScrollViewer>
</UserControl>
