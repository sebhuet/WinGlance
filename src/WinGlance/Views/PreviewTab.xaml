<UserControl x:Class="WinGlance.Views.PreviewTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:WinGlance.Controls"
             xmlns:converters="clr-namespace:WinGlance.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="400">

    <UserControl.Resources>
        <converters:LayoutToPanelConverter x:Key="LayoutToPanelConverter" />
        <converters:BoolToBorderBrushConverter x:Key="ActiveBorderConverter" />

        <!-- Group header: app icon + app name -->
        <DataTemplate x:Key="GroupHeaderTemplate">
            <StackPanel Orientation="Horizontal" Margin="4,6,4,2">
                <Image Source="{Binding Items[0].Icon}"
                       Width="16" Height="16"
                       RenderOptions.BitmapScalingMode="HighQuality"
                       Margin="0,0,6,0"
                       VerticalAlignment="Center" />
                <TextBlock Text="{Binding Name}"
                           Foreground="#FFCCCCCC"
                           FontWeight="SemiBold"
                           FontSize="12"
                           VerticalAlignment="Center" />
                <TextBlock Foreground="#FF888888"
                           FontSize="11"
                           VerticalAlignment="Center"
                           Margin="6,0,0,0">
                    <Run Text="(" /><Run Text="{Binding ItemCount, Mode=OneWay}" /><Run Text=")" />
                </TextBlock>
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto"
                  HorizontalScrollBarVisibility="Auto"
                  Background="Transparent">
        <ItemsControl ItemsSource="{Binding GroupedWindows}"
                      ItemsPanel="{Binding Layout, Converter={StaticResource LayoutToPanelConverter}}">

            <!-- Grouping -->
            <ItemsControl.GroupStyle>
                <GroupStyle HeaderTemplate="{StaticResource GroupHeaderTemplate}" />
            </ItemsControl.GroupStyle>

            <!-- Individual thumbnail item -->
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Border Margin="4"
                            Padding="2"
                            CornerRadius="4"
                            BorderThickness="2"
                            BorderBrush="{Binding IsActive, Converter={StaticResource ActiveBorderConverter}}"
                            Background="#33000000"
                            ToolTip="{Binding Title}">
                        <StackPanel>
                            <!-- DWM thumbnail area -->
                            <controls:ThumbnailControl
                                SourceHwnd="{Binding Hwnd}"
                                ThumbnailManager="{Binding DataContext.ThumbnailManager, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                Width="{Binding DataContext.ThumbnailWidth, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                Height="{Binding DataContext.ThumbnailHeight, RelativeSource={RelativeSource AncestorType=UserControl}}" />

                            <!-- Window title -->
                            <TextBlock Text="{Binding Title}"
                                       Foreground="#FFAAAAAA"
                                       FontSize="11"
                                       Margin="4,2,4,2"
                                       TextTrimming="CharacterEllipsis"
                                       MaxWidth="{Binding DataContext.ThumbnailWidth, RelativeSource={RelativeSource AncestorType=UserControl}}" />
                        </StackPanel>
                    </Border>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </ScrollViewer>
</UserControl>
